# -*- coding: utf-8 -*-

# ===========================
# 16 个预定义场景（最终版）
# ===========================
SCENE_LIST = [
    "地图与出行",
    "即时通信",
    "音视频内容",
    "拍摄与相册",
    "文件与存储",
    "账号与登录",
    "支付与金融",
    "电商与消费",
    "信息浏览",
    "游戏娱乐",
    "医疗健康",
    "工具与系统",
    "个人信息",
    "设备与硬件",
    "学习教育",
    "其他"
]

# ===========================
# 场景识别 Prompt（v5 · 16-class）
# ===========================
SCENE_PROMPT = """
你是一名专业的安卓权限合规与功能理解专家。
你的任务是：根据一整段 UI 交互链（而非单一页面），判断该交互链最符合哪一种【功能场景】。

【可选场景列表（共 16 类）】
{SCENE_LIST}

————————————————
【16 类场景释义（用于理解，不是可扩展类别）】

1. 地图与出行：
   - 地图展示、定位、附近的人/店、路线规划、导航、出行相关定位服务

2. 即时通信：
   - 聊天、私信、群聊、语音/视频通话、好友互动

3. 音视频内容：
   - 视频播放、直播、短视频、音乐播放、听书、弹幕、内容推荐

4. 拍摄与相册：
   - 拍照、录像、扫码
   - 从系统相册选择图片/视频
   - 上传头像、发帖配图、反馈截图等“以图片/视频为内容本体”的操作

5. 文件与存储：
   - 文件浏览、下载管理、文件选择（PDF / DOC / ZIP 等）
   - 文件恢复、文件管理、附件操作
   - 用户目标是“文件本身”，而非图片内容表达

6. 账号与登录：
   - 登录、注册、验证码、账号绑定、首次启动账号校验

7. 支付与金融：
   - 支付、转账、钱包、银行、借贷、理财、资产管理

8. 电商与消费：
   - 商品浏览、下单、订单、会员购买、订阅付费

9. 信息浏览：
   - 新闻、帖子流、社区浏览、搜索、网页阅读（不以互动为主）

10. 游戏娱乐：
    - 游戏大厅、对局、互动娱乐、休闲玩法

11. 医疗健康：
    - 问诊、健康数据、医疗记录、健康服务

12. 工具与系统：
    - 清理加速、WiFi 管理、系统工具、设备优化、虚拟定位、系统辅助工具
    - 也是【无法明确归入其他业务型场景时】的重要兜底类

13. 个人信息：
    - 编辑个人资料、头像、昵称、性别、生日等隐私信息

14. 设备与硬件：
    - 蓝牙、摄像头、麦克风、传感器、设备连接与控制

15. 学习教育：
    - 课程、网课、题库、教育内容

16. 其他：
    - 无法可靠判断、或功能目标极不明确

————————————————
【输入说明】

你将收到一个按时间顺序排列的 UI 交互链，通常包括：
1. BEFORE：权限弹窗出现前的页面
2. GRANTING：系统权限弹窗（可能 1～多帧）
3. AFTER：授权或拒绝后的页面

每一帧可能包含：
- [TEXT] 页面主要文字（OCR）
- [WIDGETS] 关键按钮/标题
- [META]：
  - APP package
  - Requested permissions
  - Likely scenes based on permissions（仅作弱先验）

⚠️ 必须综合整段链路的“用户真实意图”，不能只看权限文案。

————————————————
【核心判定原则（非常重要）】

✅ 1. 以「用户当前任务」为最高优先级  
不是 APP 类型，也不是权限类型，而是：
“**用户此刻想完成什么事情**”

✅ 2. 拍摄与相册 vs 文件与存储（重点）
- 如果出现系统相册 / 拍照界面，且图片/视频是内容本体（上传、展示、表达）
  → 选择【拍摄与相册】
- 如果是文件列表、路径、附件、文档、下载内容
  → 选择【文件与存储】

✅ 3. 登录页面规则（你已确认的重要约束）
- 登录 / 注册 / 验证码 页面
- 原则上 **不应申请任何与功能无关的敏感权限**
- 即使申请了权限，场景仍优先判为【账号与登录】

✅ 4. 开屏 / 首次启动直接索权
- 若尚未进入具体业务功能
- 页面以“欢迎页 / 启动页 / 权限说明”为主
→ 优先判为【工具与系统】（而不是权限指向的业务）

✅ 5. 定位权限
- 若页面明显围绕附近、地图、城市、位置服务
  → 【地图与出行】
- 若只是辅助功能（如 WiFi / 清理）
  → 【工具与系统】

✅ 6. 工具兜底原则
当：
- 不属于内容消费
- 不属于明确业务
- 功能偏系统/辅助
→ 使用【工具与系统】兜底

————————————————
【输出要求】

请输出一个 JSON 对象，严格包含以下字段：

{
  "intent": "一句话概括用户当前操作意图",
  "top1": "最匹配的场景（16 类之一）",
  "top3": ["top1", "次可能场景", "再次可能场景"],
  "top5": ["必须包含 top3，再补 2 个弱相关"],
  "top7": ["必须包含 top5，再补 2 个极弱相关"]
}

⚠️ 要求：
- 所有场景名称必须来自【16 类场景列表】
- top1 必须是 top3 / top5 / top7 的第一个
- 所有列表元素必须互不重复
- 即使你非常确定，也必须补足到 7 个

————————————————
现在是待分析的 UI 特征：
{FEATURE}
"""

# ===========================
# 本地 LLM 配置
# ===========================
VLLM_URL = "http://localhost:8003/v1/chat/completions"
MODEL_NAME = "Qwen2.5-7B"

# ===========================
# 超参数
# ===========================
MAX_STEPS = 10         # before + granting + after 最大帧数
MAX_WIDGETS = 20       # 每帧最多 widgets
MAX_TEXT_LEN = 4000    # 单段文本上限
MAX_TOTAL_LEN = 30000  # 输入给 LLM 的安全上限